<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>高知県パーキング検索</title>
  <style>
    body { margin: 0; font-family: Arial; }
    #topbar {
      padding: 10px;
      background: #f0f0f0;
    }
    #map {
      height: 90vh;
      width: 100%;
    }
    input {
      padding: 8px;
      width: 250px;
    }
    button {
      padding: 8px;
    }
  </style>
</head>
<body>

<div id="topbar">
  <input id="placeInput" type="text" placeholder="例：ひろめ市場">
  <button onclick="searchPlace()">検索</button>
</div>

<div id="map"></div>

<script>
let map;
let markers = [];

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    center: { lat: 33.5597, lng: 133.5311 }, // 高知市中心
    zoom: 15
  });
}

function searchPlace() {
  const address = document.getElementById("placeInput").value + " 高知県";
  const geocoder = new google.maps.Geocoder();

  clearMarkers();

  geocoder.geocode({ address: address }, function(results, status) {
    if (status === "OK") {
      const location = results[0].geometry.location;

      map.setCenter(location);

      const destinationMarker = new google.maps.Marker({
        map: map,
        position: location,
        label: "目的地"
      });

      markers.push(destinationMarker);

      searchParking(location);

    } else {
      alert("場所が見つかりませんでした");
    }
  });
}

function searchParking(location) {
  const service = new google.maps.places.PlacesService(map);

  service.nearbySearch({
    location: location,
    radius: 500,
    keyword: "駐車場"
  }, function(results, status) {
    if (status === google.maps.places.PlacesServiceStatus.OK) {
      results.forEach(place => {
        const marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location,
          icon: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png"
        });

        const infowindow = new google.maps.InfoWindow({
          content: place.name
        });

        marker.addListener("click", () => {
          infowindow.open(map, marker);
        });

        markers.push(marker);
      });
    }
  });
}

function clearMarkers() {
  markers.forEach(marker => marker.setMap(null));
  markers = [];
}
</script>

<!-- ★ここに自分のAPIキーを入れる -->
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places&callback=initMap">
</script>

</body>
</html>
