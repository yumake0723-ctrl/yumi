<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>高知県 パーキング検索</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    #controls {
      padding: 10px;
      background: #f4f4f4;
    }
    #map {
      height: 90vh;
      width: 100%;
    }
    input {
      width: 300px;
      padding: 8px;
    }
    button {
      padding: 8px;
    }
  </style>
</head>
<body>

<div id="controls">
  <input type="text" id="destination" placeholder="目的地を入力（例：ひろめ市場）">
  <button onclick="searchLocation()">検索</button>
</div>

<div id="map"></div>

<script>
let map;
let service;
let infowindow;

function initMap() {
  // 初期表示（高知市中心）
  const kochi = { lat: 33.5597, lng: 133.5311 };

  map = new google.maps.Map(document.getElementById("map"), {
    center: kochi,
    zoom: 15,
  });

  service = new google.maps.places.PlacesService(map);
  infowindow = new google.maps.InfoWindow();
}

function searchLocation() {
  const destination = document.getElementById("destination").value;
  const geocoder = new google.maps.Geocoder();

  geocoder.geocode({ address: destination + ", 高知県" }, function(results, status) {
    if (status === "OK") {
      const location = results[0].geometry.location;
      map.setCenter(location);

      new google.maps.Marker({
        map: map,
        position: location,
        label: "目的地"
      });

      searchParking(location);
    } else {
      alert("場所が見つかりませんでした");
    }
  });
}

function searchParking(location) {
  const request = {
    location: location,
    radius: 500, // 500m以内
    keyword: "駐車場"
  };

  service.nearbySearch(request, function(results, status) {
    if (status === google.maps.places.PlacesServiceStatus.OK) {
      for (let i = 0; i < results.length; i++) {
        createMarker(results[i]);
      }
    }
  });
}

function createMarker(place) {
  const marker = new google.maps.Marker({
    map: map,
    position: place.geometry.location,
    icon: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
  });

  google.maps.event.addListener(marker, "click", function() {
    infowindow.setContent(place.name);
    infowindow.open(map, this);
  });
}
</script>

<!-- ↓↓↓ 自分のAPIキーに置き換えてください ↓↓↓ -->
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places&callback=initMap">
</script>

</body>
</html>

